<!-- templates/auth/register.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Đăng ký — LuxDine</title>
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

    <style>
        :root {
            --color-primary: #0a0a23;
            --color-secondary: #f97316;
            --color-bg: #f9fafb;
            --color-border: #e5e7eb;
            --color-text: #111827;
            --color-text-muted: #6b7280;
            --color-success: #22c55e;
            --color-warning: #facc15;
            --color-error: #ef4444;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-card: 0 1px 2px rgba(0, 0, 0, .05);
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-xxl: 64px;
            --font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            --h1-size: 32px;
            --h1-lh: 1.2;
            --h1-weight: 700;
            --h2-size: 24px;
            --h2-lh: 1.3;
            --h2-weight: 600;
            --h3-size: 20px;
            --h3-lh: 1.4;
            --h3-weight: 500;
            --body-size: 16px;
            --body-lh: 1.5;
            --body-weight: 400;
            --small-size: 14px;
            --small-lh: 1.4;
        }

        *, *::before, *::after {
            box-sizing: border-box
        }

        html, body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: var(--font-family);
            font-size: var(--body-size);
            line-height: var(--body-lh);
            color: var(--color-text);
            background: linear-gradient(180deg, #fff 0%, var(--color-bg) 100%);
        }

        .navbar {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md)
        }

        .brand {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 700;
            color: var(--color-primary)
        }

        .brand__logo {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: var(--color-primary)
        }

        .nav {
            display: flex;
            gap: var(--space-lg)
        }

        .nav a {
            text-decoration: none;
            color: var(--color-text);
            font-weight: 500
        }

        .nav a:hover {
            text-decoration: underline
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-md);
            display: grid;
            grid-template-columns:1.2fr 1fr;
            gap: var(--space-xxl);
            align-items: center;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns:1fr;
                gap: var(--space-xl);
                padding-top: var(--space-lg)
            }

            .hero {
                order: 2
            }

            .card {
                order: 1
            }
        }

        .hero h1 {
            font-size: var(--h1-size);
            line-height: var(--h1-lh);
            font-weight: var(--h1-weight);
            color: var(--color-primary);
            margin: 0 0 var(--space-md)
        }

        .hero p {
            color: var(--color-text-muted);
            margin: 0 0 var(--space-lg);
            max-width: 60ch
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            background: #fef3c7;
            color: #92400e;
            font-size: 12px;
            font-weight: 600
        }

        .card {
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: clamp(20px, 4vw, 32px)
        }

        .card__header {
            margin-bottom: var(--space-md)
        }

        .card__title {
            font-size: var(--h2-size);
            line-height: var(--h2-lh);
            font-weight: var(--h2-weight);
            margin: 0 0 var(--space-sm);
            color: var(--color-primary)
        }

        .card__desc {
            color: var(--color-text-muted);
            margin: 0
        }

        /* Alerts + auto-dismiss transition */
        .alert {
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            margin-bottom: var(--space-md);
            font-size: var(--small-size);
            transition: opacity .25s ease, transform .25s ease;
        }

        .alert--error {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca
        }

        .alert--info {
            background: #eff6ff;
            color: #1e3a8a;
            border: 1px solid #bfdbfe
        }

        .alert.is-hiding {
            opacity: 0;
            transform: translateY(-4px);
            pointer-events: none
        }

        .form {
            display: grid;
            gap: var(--space-md);
            margin-top: var(--space-lg)
        }

        .field {
            display: grid;
            gap: var(--space-sm)
        }

        .label {
            font-weight: 500
        }

        .hint {
            font-size: var(--small-size);
            color: var(--color-text-muted)
        }

        .input {
            width: 100%;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            font: inherit;
            outline: none;
            background: #fff
        }

        .input::placeholder {
            color: #9ca3af
        }

        .input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(10, 10, 35, .08)
        }

        .input--error {
            border-color: var(--color-error)
        }

        .error-text {
            font-size: var(--small-size);
            color: var(--color-error);
            margin-top: -4px
        }

        .form__row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-sm)
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 24px;
            border-radius: var(--radius-md);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            border: 1px solid transparent;
            transition: transform .02s ease, box-shadow .2s ease, background .2s ease, color .2s ease, border-color .2s ease
        }

        .btn:active {
            transform: translateY(1px)
        }

        .btn--primary {
            background: var(--color-primary);
            color: #fff
        }

        .btn--primary:hover {
            box-shadow: 0 4px 14px rgba(10, 10, 35, .2)
        }

        .btn--primary:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed
        }

        .btn--secondary {
            background: #fff;
            color: var(--color-secondary);
            border-color: var(--color-secondary)
        }

        .btn--secondary:hover {
            background: rgba(249, 115, 22, .06)
        }

        .actions {
            display: grid;
            gap: var(--space-sm);
            margin-top: var(--space-md)
        }

        .actions .btn {
            width: 100%
        }

        .note {
            margin-top: var(--space-md);
            font-size: var(--small-size);
            color: var(--color-text-muted);
            text-align: center
        }

        .note a {
            color: var(--color-secondary);
            font-weight: 600;
            text-decoration: none
        }

        .note a:hover {
            text-decoration: underline
        }
    </style>
</head>
<body>
<header aria-label="Site" class="navbar">
    <div aria-label="Bella Vista" class="brand">
        <span aria-hidden="true" class="brand__logo"></span>
        <span>LuxDine</span>
    </div>
    <nav aria-label="Primary" class="nav">
        <a th:href="@{/home}">Trang chủ</a>
        <a th:href="@{/menu}">Thực đơn</a>
        <a href="#">Liên hệ</a>
        <a th:href="@{/login}">Đăng nhập</a>
        <a aria-current="page" th:href="@{/register}">Đăng ký</a>
    </nav>
</header>

<main class="container">
    <section aria-labelledby="register-hero-title" class="hero">
        <h1 id="register-hero-title">Tạo tài khoản mới ✨</h1>
        <p>Đăng ký để đặt bàn nhanh, theo dõi đơn và nhận ưu đãi dành riêng cho bạn.</p>
        <div aria-label="Info" class="badge">Bảo mật</div>
        <p class="hint" style="margin-top: var(--space-sm)">Chúng tôi tuân thủ CSRF và không chia sẻ thông tin của
            bạn.</p>
    </section>

    <section aria-labelledby="register-card-title" class="card">
        <div class="card__header">
            <h2 class="card__title" id="register-card-title">Đăng ký</h2>
            <p class="card__desc">Nhập thông tin của bạn để tiếp tục xác minh email.</p>
        </div>

        <!-- Alerts (server message) -->
        <div aria-live="polite" class="alert alert--info" role="status" th:if="${message != null}"
             th:text="${message}"></div>

        <!-- Form -->
        <form class="form" method="post" novalidate th:action="@{/register}" th:object="${user}">
            <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>

            <div class="field">
                <label class="label" for="username">Tên đăng nhập</label>
                <input autocomplete="username" class="input" id="username" placeholder="Nhập tên đăng nhập"
                       required
                       th:field="*{username}" type="text"/>
                <p class="hint">3–30 ký tự, không khoảng trắng.</p>
            </div>

            <div class="field">
                <label class="label" for="email">Email</label>
                <input autocomplete="email" class="input" id="email" placeholder="you@example.com"
                       required
                       th:field="*{email}" type="email"/>
            </div>

            <div class="field">
                <label class="label" for="password">Mật khẩu</label>
                <input autocomplete="new-password" class="input" id="password" minlength="6"
                       placeholder="Tạo mật khẩu"
                       required th:field="*{password}" type="password"/>
                <p class="hint">Tối thiểu 6 ký tự.</p>
            </div>

            <div class="field">
                <label class="label" for="confirmPassword">Nhập lại mật khẩu</label>
                <input autocomplete="new-password" class="input" id="confirmPassword" name="confirmPassword"
                       placeholder="Xác nhận mật khẩu"
                       required type="password"/>
                <p class="error-text" id="confirm-error" role="alert" style="display:none;">Mật khẩu xác nhận không
                    khớp.</p>
            </div>

            <div class="actions">
                <button class="btn btn--primary" id="btn-submit" type="submit">Đăng ký</button>
                <a class="btn btn--secondary" th:href="@{/login}">Đã có tài khoản? Đăng nhập</a>
            </div>

            <p class="note">
                Khi tiếp tục, bạn đồng ý với <a href="#">Điều khoản</a> & <a href="#">Chính sách bảo mật</a> của chúng
                tôi.
            </p>
        </form>
    </section>
</main>

<!-- Auto-dismiss alerts after 5s -->
<script>
    (function () {
        const alerts = Array.from(document.querySelectorAll('.alert'));
        if (!alerts.length) return;
        const prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        setTimeout(() => {
            alerts.forEach(el => {
                if (!prefersReduce) {
                    el.classList.add('is-hiding');
                    setTimeout(() => {
                        el.style.display = 'none';
                    }, 300);
                } else {
                    el.style.display = 'none';
                }
            });
        }, 5000);
    })();
</script>

<script>
    (function () {
        const p1 = document.getElementById('password');
        const p2 = document.getElementById('confirmPassword');
        const err = document.getElementById('confirm-error');
        const btn = document.getElementById('btn-submit');

        // Cờ "touched": chỉ hiện lỗi sau khi người dùng đã tương tác
        let touched = false;

        function bothFilled() {
            return p1.value.length > 0 && p2.value.length > 0;
        }

        function matched() {
            return p1.value === p2.value;
        }

        function render() {
            // Chỉ hiển thị lỗi khi: đã tương tác + cả hai ô có giá trị + KHÔNG khớp
            const showError = touched && bothFilled() && !matched();

            err.style.display = showError ? '' : 'none';
            p2.classList.toggle('input--error', showError);

            // Nút đăng ký chỉ bật khi cả hai có giá trị và khớp
            btn.disabled = !(bothFilled() && matched());
        }

        // Đánh dấu đã tương tác khi người dùng gõ hoặc blur ô xác nhận
        p2.addEventListener('input', () => {
            if (!touched && p2.value.length) touched = true;
            render();
        });
        p2.addEventListener('blur', () => {
            touched = true;
            render();
        });

        // Khi thay đổi mật khẩu chính, cũng re-validate
        p1.addEventListener('input', render);

        // Ẩn lỗi khi vừa tải trang, không gọi render() để khỏi hiện sớm
        btn.disabled = true; // khoá nút đến khi hợp lệ
    })();
</script>
</body>
</html>
