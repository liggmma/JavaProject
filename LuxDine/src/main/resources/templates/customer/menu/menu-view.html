<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Thực đơn | LuxDine</title>

    <!-- Design tokens từ fragment -->
    <th:block th:replace="~{customer/fragments/header :: styles}"></th:block>
    <th:block th:replace="~{customer/fragments/footer :: styles}"></th:block>

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        /* =============== Page Scope: chỉ áp cho trang Menu =============== */
        .menu-page {
            font-family: var(--font, Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial);
            background: var(--color-bg, #F9FAFB);
            color: var(--color-text, #111827);
        }

        /* Hero */
        .menu-page .hero {
            background: linear-gradient(135deg, var(--color-primary, #0A0A23), #1a1a3a);
            color: #fff;
            text-align: center;
            padding: var(--space-12, 64px) var(--space-7, 24px);
        }

        .menu-page .hero__title {
            font-size: 32px;
            line-height: 1.2;
            font-weight: 800;
            margin: 0 0 8px;
        }

        .menu-page .hero__subtitle {
            font-size: 16px;
            line-height: 1.6;
            opacity: .9;
            margin: 0 auto;
            max-width: 70ch;
        }

        /* Container */
        .menu-page .container {
            max-width: var(--container, 1200px);
            margin: 0 auto;
            padding: var(--space-10, 48px) var(--space-7, 24px);
        }

        /* Quick actions */
        .menu-page .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin: 0 0 var(--space-7, 24px);
        }

        .menu-page .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            border: 1px solid transparent;
            transition: background .2s, border-color .2s, color .2s, transform .02s;
            user-select: none;
        }

        .menu-page .btn:active {
            transform: translateY(1px);
        }

        .menu-page .btn--primary {
            background: var(--color-primary, #0A0A23);
            color: #fff;
        }

        .menu-page .btn--primary:hover {
            filter: brightness(1.08);
        }

        .menu-page .btn--ghost {
            background: #fff;
            color: var(--color-secondary, #F97316);
            border-color: var(--color-secondary, #F97316);
        }

        .menu-page .btn--ghost:hover {
            background: rgba(249, 115, 22, .06);
        }

        /* Section header */
        .menu-page .section-head {
            display: flex;
            justify-content: center;
            text-align: center;
            margin-bottom: var(--space-6, 20px);
        }

        .menu-page .section-head h2 {
            font-size: 24px;
            margin: 0;
            color: var(--color-primary, #0A0A23);
        }

        /* Grid */
        .menu-page .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: var(--space-8, 32px);
        }

        /* Card */
        .menu-page .card {
            background: var(--color-surface, #fff);
            border: 1px solid var(--color-border, #E5E7EB);
            border-radius: 12px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
            overflow: hidden;
            transform: translateY(0);
            transition: transform .25s ease, box-shadow .25s ease;
            opacity: 0;
            animation: fadeInUp .55s ease-out forwards;
        }

        .menu-page .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 24px rgba(0, 0, 0, .08);
        }

        .menu-page .card__img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
            background: #f3f4f6;
        }

        .menu-page .card__body {
            padding: 14px 16px 16px;
        }

        .menu-page .card__top {
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 12px;
            margin-bottom: 6px;
            min-height: 44px;
        }

        .menu-page .item-name {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            color: var(--color-primary, #0A0A23);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        /* Giá nằm dưới tên */
        .menu-page .price {
            display: block;
            margin-top: 2px;
            font-weight: 800;
            color: var(--color-secondary, #F97316);
            white-space: nowrap;
        }

        /* Mô tả 1 dòng + … (giữ nguyên nếu bạn đã có) */
        .menu-page .desc {
            color: #555;
            line-height: 1.4;
            margin: 8px 0 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Hàng meta: sao + đã bán trên 1 dòng */
        .menu-page .meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin: 6px 0 8px;
        }

        .menu-page .meta-left {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .menu-page .sold {
            font-size: 13px;
            color: var(--color-text-muted, #6B7280);
        }

        /* Rating (5 sao demo) */
        .menu-page .rating {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .menu-page .stars {
            display: inline-flex;
            gap: 2px;
            color: #FACC15;
        }

        .menu-page .stars svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .menu-page .rating__label {
            font-weight: 700;
            font-size: 13px;
            color: #1f2937;
        }

        /* Tag phổ biến tách riêng, nằm dưới meta */
        .menu-page .badge-wrap {
            margin: 0 0 10px;
        }

        .menu-page .badge-popular {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 700;
            color: var(--color-secondary, #F97316);
            background: rgba(249, 115, 22, .08);
            border: 1px solid rgba(249, 115, 22, .35);
            padding: 4px 8px;
            border-radius: 999px;
        }


        /* Empty */
        .menu-page .empty {
            text-align: center;
            color: var(--color-text-muted, #6B7280);
            padding: var(--space-12, 64px) var(--space-7, 24px);
        }

        .menu-page .empty h3 {
            margin: 0 0 8px;
            color: var(--color-primary, #0A0A23);
        }

        /* Motion */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(24px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .menu-page .card {
                animation: none;
                opacity: 1;
            }

            .menu-page .card:hover {
                transform: none;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .menu-page .hero__title {
                font-size: 28px;
            }

            .menu-page .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body class="menu-page">
<!-- Header -->
<th:block th:replace="~{customer/fragments/header :: header}"></th:block>

<!-- Hero -->
<section class="hero">
    <h1 class="hero__title">Thực đơn</h1>
    <p class="hero__subtitle">Gợi ý từ bếp trưởng, tươi mới mỗi ngày. Duyệt theo danh mục và khám phá món bạn yêu
        thích.</p>
</section>

<!-- Content -->
<main class="container">
    <!-- Quick actions -->
    <nav class="quick-actions" aria-label="Tác vụ nhanh">
        <a class="btn btn--primary" th:href="@{/browse/menu}">Xem tất cả</a>
        <a class="btn btn--ghost" th:href="@{/browse/bundles/TASTING_MENU}">Thực đơn Tasting</a>
        <a class="btn btn--ghost" th:href="@{/browse/bundles/COMBO}">Combo ưu đãi</a>
    </nav>

    <!-- Section head -->
    <div class="section-head">
        <h2>Bán chạy tuần này</h2>
    </div>

    <!-- Grid of items -->
    <section class="grid" th:if="${!#lists.isEmpty(menuItems)}">
        <article class="card"
                 th:each="item,iter : ${menuItems}"
                 th:style="|animation-delay: ${iter.index * 0.07}s|">
            <img class="card__img"
                 th:src="${item.imageUrl != null ? item.imageUrl : 'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe'}"
                 th:alt="${item.name}" loading="lazy" decoding="async"
                 onerror="this.src='https://via.placeholder.com/520x320?text=No+Image';"/>

            <div class="card__body">
                <!-- Tên món -->
                <h3 class="item-name" th:text="${item.name}">Tên món</h3>

                <!-- Giá (VND, format bằng JS) -->
                <div class="price price-vnd" th:attr="data-price=${item.price}">0 VND</div>

                <!-- Mô tả 1 dòng -->
                <p class="desc" th:text="${item.description}">Mô tả ngắn gọn của món…</p>

                <!-- Sao + Đã bán (cùng 1 dòng) -->
                <div class="meta">
                    <div class="meta-left">
                        <div class="rating" role="img" aria-label="5 trên 5 sao">
                            <div class="stars" aria-hidden="true">
                                <svg viewBox="0 0 20 20">
                                    <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                </svg>
                                <svg viewBox="0 0 20 20">
                                    <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                </svg>
                                <svg viewBox="0 0 20 20">
                                    <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                </svg>
                                <svg viewBox="0 0 20 20">
                                    <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                </svg>
                                <svg viewBox="0 0 20 20">
                                    <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                </svg>
                            </div>
                            <span class="rating__label">5.0</span>
                        </div>
                    </div>

                    <span class="sold"
                          th:text="${(item.soldCount != null ? item.soldCount : 0) + ' đã bán'}">0 đã bán</span>
                </div>

                <!-- Tag phổ biến (dưới meta) -->
                <div class="badge-wrap">
        <span class="badge-popular"
              th:if="${top10Ids != null and #lists.contains(top10Ids, item.id)}">★ Phổ biến</span>
                </div>

                <!-- Nút cuối cùng -->
                <a class="btn btn--primary" th:href="@{/menu/item/{slug}(slug=${item.slug})}">
                    Xem chi tiết
                </a>
            </div>
        </article>
    </section>


    <!-- Empty state -->
    <div class="empty" th:if="${#lists.isEmpty(menuItems)}">
        <h3>Chưa có món để hiển thị</h3>
        <p>Chúng tôi đang cập nhật danh mục này. Vui lòng quay lại sau!</p>
        <a class="btn btn--ghost" th:href="@{/browse/menu}">Xem toàn bộ món →</a>
    </div>
</main>

<!-- Footer -->
<th:block th:replace="~{customer/fragments/footer :: footer}"></th:block>
<th:block th:replace="~{customer/fragments/footer :: scripts}"></th:block>
<th:block th:replace="~{customer/fragments/header :: scripts}"></th:block>

<script th:inline="javascript">
    // Định dạng VND theo yêu cầu
    function formatPriceVND(price) {
        return new Intl.NumberFormat('vi-VN').format(Math.round(price)) + ' VND';
    }

    // Áp dụng cho tất cả giá trên thẻ
    function applyVNDPrices() {
        document.querySelectorAll('.price-vnd').forEach(el => {
            const p = Number(el.getAttribute('data-price') || 0);
            el.textContent = formatPriceVND(p);
        });
    }

    document.addEventListener('DOMContentLoaded', applyVNDPrices);
</script>
</body>
</html>
