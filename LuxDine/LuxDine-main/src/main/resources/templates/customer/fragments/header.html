<!-- templates/customer/fragments/header.html -->
<th:block th:fragment="styles">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

    <style>
        /* ===================== Design Tokens (LuxDine) ===================== */
        :root{
            --color-primary:#0a0a23;
            --color-secondary:#f97316;
            --color-bg:#f9fafb;
            --color-surface:#ffffff;
            --color-border:#e5e7eb;
            --color-text:#111827;
            --color-text-muted:#6b7280;
            --color-success:#22c55e;
            --color-warning:#f59e0b;
            --color-error:#ef4444;

            --radius-sm:6px;
            --radius-md:8px;
            --radius-lg:12px;
            --shadow-card:0 1px 2px rgba(0,0,0,.05);
            --shadow-elev:0 6px 24px rgba(0,0,0,.08);

            --space-2:4px; --space-3:8px; --space-4:12px; --space-5:16px;
            --space-6:20px; --space-7:24px; --space-8:32px; --space-9:40px;
            --space-10:48px; --space-12:64px;

            --font: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            --h1-size:40px; --h1-lh:1.2; --h1-w:800;
            --h2-size:28px; --h2-lh:1.3; --h2-w:700;
            --h3-size:20px; --h3-lh:1.4; --h3-w:600;
            --body-size:16px; --body-lh:1.6; --small-size:14px;
            --container:1200px;
        }

        /* ===== Scope táº¥t cáº£ rule vÃ o header Ä‘á»ƒ trÃ¡nh rÃ² rá»‰ ===== */
        header.site-header { position: sticky; top: 0; z-index: 40;
            background: rgba(255,255,255,.9); backdrop-filter: saturate(180%) blur(8px);
            border-bottom:1px solid var(--color-border);
            font-family:var(--font);
        }
        header.site-header .container_header{
            max-width:var(--container); margin:0 auto; padding:0 var(--space-7);
        }
        header.site-header .nav-bar{
            display:flex; align-items:center; justify-content:space-between;
            gap:var(--space-6); padding:var(--space-5) 0;
        }

        /* Brand */
        header.site-header .brand{ display:flex; align-items:center; gap:var(--space-4);
            font-weight:800; color:var(--color-primary); text-decoration:none;
        }
        header.site-header .brand__logo{ width:40px; height:40px; border-radius:12px;
            background:linear-gradient(135deg, var(--color-primary) 0%, #1a1a3a 50%, #0f0f23 100%);
            display:flex; align-items:center; justify-content:center; color:#fff;
            font-weight:900; font-size:18px; box-shadow:0 4px 12px rgba(10,10,35,.4);
            position:relative; overflow:hidden;
        }
        header.site-header .brand__logo::before{ content:"ğŸ½ï¸"; position:absolute; font-size:24px; z-index:2; }

        /* Äá»•i tÃªn .nav -> .site-nav Ä‘á»ƒ trÃ¡nh trÃ¹ng vá»›i .nav nÆ¡i khÃ¡c */
        header.site-header .site-nav{ display:flex; align-items:center; gap:var(--space-6); }
        header.site-header .site-nav a{ color:var(--color-text); font-weight:500; text-decoration:none; }
        header.site-header .site-nav a[aria-current="page"]{
            color:var(--color-primary); text-decoration:underline; text-underline-offset:4px;
        }

        /* Buttons trong header: scope theo header Ä‘á»ƒ khÃ´ng ghi Ä‘Ã¨ .myres-btn */
        header.site-header .btn{
            display:inline-flex; align-items:center; justify-content:center; gap:8px;
            padding:10px 18px; border-radius:var(--radius-md); border:1px solid transparent;
            font-weight:600; cursor:pointer; transition: box-shadow .2s, transform .02s;
            text-decoration:none;
        }
        header.site-header .btn:active{ transform: translateY(1px); }
        header.site-header .btn--secondary{
            background:#fff; color:var(--color-secondary); border-color:var(--color-secondary);
        }
        header.site-header .btn--secondary:hover{ background: rgba(249,115,22,.06); }

        /* User menu */
        header.site-header .user-menu{ position:relative; }
        header.site-header .user-btn .avatar{
            width:24px; height:24px; border-radius:999px; background:var(--color-primary);
            color:#fff; display:grid; place-items:center; font-size:12px; font-weight:800;
        }
        header.site-header .user-btn .chev{ width:14px; height:14px; }

        /* Äá»•i tÃªn .menu -> .user-menu__panel; .menu-item -> .user-menu__item */
        header.site-header .user-menu__panel{
            position:absolute; right:0; top:calc(100% + 8px); background:#fff;
            border:1px solid var(--color-border); border-radius:10px; min-width:220px;
            box-shadow:var(--shadow-elev); padding:8px; display:grid; gap:4px; z-index:1000; white-space:nowrap;
        }
        header.site-header .user-menu__item{
            text-decoration:none; display:block; text-align:left;
            padding:10px 12px; border-radius:8px; color:var(--color-text);
            background:none; border:none; font:inherit; cursor:pointer;
        }
        header.site-header .user-menu__item:hover,
        header.site-header .user-menu__item:focus{ background:#f3f4f6; outline:none; }
        header.site-header .user-menu__item.logout{ color:var(--color-error); width: 100%;}

        /* Utility */
        [hidden]{ display:none !important; }
    </style>
</th:block>

<th:block th:fragment="header">
    <header class="site-header" aria-label="Site">
        <div class="container_header nav-bar">
            <!-- Logo -->
            <a th:href="@{/home}" class="brand">
                <span class="brand__logo" aria-hidden="true"></span>
                <span>LuxDine</span>
            </a>

            <!-- Navigation: .nav -> .site-nav -->
            <nav class="site-nav" aria-label="Primary">
                <a th:href="@{/home}">Trang chá»§</a>
                <a th:href="@{/menu}">Thá»±c Ä‘Æ¡n</a>
                <a th:href="@{/layout}">SÆ¡ Ä‘á»“</a>
                <a th:href="@{/reservations}">ÄÆ¡n Ä‘áº·t bÃ n</a>
                <a th:href="@{/orders}">ÄÆ¡n Äƒn uá»‘ng</a>
                <a th:href="@{/chat}" th:if="${#authentication != null and #authentication.authenticated and !(#authentication instanceof T(org.springframework.security.authentication.AnonymousAuthenticationToken))}">LiÃªn há»‡</a>
            </nav>

            <!-- Right side (Login / User) -->
            <div class="nav-cta" id="nav-cta">
                <!-- Logged-in -->
                <div class="user-menu"
                     th:if="${#authentication != null and #authentication.authenticated and !(#authentication instanceof T(org.springframework.security.authentication.AnonymousAuthenticationToken))}">
                    <button id="userMenuBtn" class="btn btn--secondary user-btn" type="button" aria-haspopup="true" aria-expanded="false">
                        <span class="avatar" th:text="${#strings.substring(#authentication.name,0,1).toUpperCase()}">U</span>
                        <span class="user-name" th:text="${#authentication.name}">Username</span>
                        <svg class="chev" viewBox="0 0 20 20" aria-hidden="true">
                            <path d="M5 7l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <!-- .menu -> .user-menu__panel ; .menu-item -> .user-menu__item -->
                    <div class="user-menu__panel" id="userMenu" role="menu" hidden>
                        <a class="user-menu__item" th:href="@{/profile}" role="menuitem">Há»“ sÆ¡</a>
                        <a class="user-menu__item" th:href="@{/orders}" role="menuitem">Lá»‹ch sá»­ Äƒn uá»‘ng</a>
                        <a class="user-menu__item" th:href="@{/reservations}" role="menuitem">Lá»‹ch sá»­ Ä‘áº·t bÃ n</a>
                        <form th:action="@{/logout}" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="user-menu__item logout" role="menuitem">ÄÄƒng xuáº¥t</button>
                        </form>
                    </div>
                </div>

                <!-- Guest -->
                <div class="guest-cta"
                     th:if="${#authentication == null or #authentication instanceof T(org.springframework.security.authentication.AnonymousAuthenticationToken)}">
                    <a th:href="@{/login}" class="btn btn--secondary">ÄÄƒng nháº­p</a>
                    <a th:href="@{/register}" class="btn btn--secondary">ÄÄƒng kÃ­</a>
                </div>
            </div>
        </div>
    </header>
</th:block>

<th:block th:fragment="scripts">
    <script th:inline="javascript">
        function attachUserMenu(){
            const btn = document.getElementById("userMenuBtn");
            const menu = document.getElementById("userMenu");
            if(!btn || !menu) return;

            const open = ()=>{ menu.hidden = false; btn.setAttribute("aria-expanded","true"); };
            const close = ()=>{ menu.hidden = true; btn.setAttribute("aria-expanded","false"); };

            btn.addEventListener("click",(e)=>{ e.stopPropagation(); menu.hidden ? open() : close(); });
            document.addEventListener("click",(e)=>{ if(!menu.contains(e.target) && !btn.contains(e.target)) close(); });
            document.addEventListener("keydown",(e)=>{ if(e.key === "Escape") close(); });

            const focusables = Array.from(menu.querySelectorAll("a,button"));
            if(focusables.length){
                focusables[0].addEventListener("keydown",(e)=>{ if(e.shiftKey && e.key === "Tab"){ e.preventDefault(); focusables[focusables.length-1].focus(); }});
                focusables[focusables.length-1].addEventListener("keydown",(e)=>{ if(!e.shiftKey && e.key === "Tab"){ e.preventDefault(); focusables[0].focus(); }});
            }
        }
        document.addEventListener("DOMContentLoaded", attachUserMenu);
    </script>
</th:block>
