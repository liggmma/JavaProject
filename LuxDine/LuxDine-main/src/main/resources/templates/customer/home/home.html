<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Trang ch·ªß ‚Äî LuxDine</title>

    <!-- Typography -->
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

    <!-- ===================== Design Tokens ===================== -->
    <!-- AI Chatbot Styles -->
    <th:block th:replace="~{customer/fragments/ai-chatbot-widget :: chatbot-styles}"></th:block>

    <style>
        :root {
            /* Colors */
            --color-primary: #0A0A23;
            --color-secondary: #F97316;
            --color-bg: #F9FAFB;
            --color-surface: #FFFFFF;
            --color-border: #E5E7EB;
            --color-text: #111827;
            --color-text-muted: #6B7280;
            --color-success: #22C55E;
            --color-warning: #F59E0B;
            --color-error: #EF4444;
            /* Radius & shadow */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-card: 0 1px 2px rgba(0, 0, 0, .05);
            --shadow-elev: 0 8px 28px rgba(0, 0, 0, .08);
            /* Spacing */
            --space-2: 4px;
            --space-3: 8px;
            --space-4: 12px;
            --space-5: 16px;
            --space-6: 20px;
            --space-7: 24px;
            --space-8: 32px;
            --space-9: 40px;
            --space-10: 48px;
            --space-12: 64px;
            /* Typography */
            --font: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            --h1-size: clamp(28px, 3.2vw, 40px);
            --h1-lh: 1.2;
            --h1-w: 800;
            --h2-size: clamp(20px, 2.2vw, 28px);
            --h2-lh: 1.3;
            --h2-w: 700;
            --h3-size: clamp(16px, 1.6vw, 20px);
            --h3-lh: 1.4;
            --h3-w: 600;
            --body-size: 16px;
            --body-lh: 1.6;
            --small-size: 14px;
            /* Layout */
            --container: 1200px;
        }

        /* ===================== Base ===================== */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: var(--font);
            font-size: var(--body-size);
            line-height: var(--body-lh);
            color: var(--color-text);
            background: linear-gradient(180deg, #fff 0%, var(--color-bg) 100%);
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        img {
            max-width: 100%;
            display: block;
        }

        .container {
            max-width: var(--container);
            margin: 0 auto;
            padding: 0 var(--space-7);
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 1px, 1px);
            white-space: nowrap;
            border: 0;
        }

        /* ===================== Utilities ===================== */
        .text-muted {
            color: var(--color-text-muted);
        }

        .mt-8 {
            margin-top: var(--space-8);
        }

        .mb-6 {
            margin-bottom: var(--space-6);
        }

        /* ===================== Buttons ===================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: var(--radius-md);
            border: 1px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: box-shadow .2s, transform .02s;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn--primary {
            background: var(--color-primary);
            color: #fff;
        }

        .btn--primary:hover {
            filter: brightness(1.05);
        }

        .btn--secondary {
            background: #fff;
            color: var(--color-secondary);
            border-color: var(--color-secondary);
        }

        .btn--secondary:hover {
            background: rgba(249, 115, 22, .06);
        }

        .btn--ghost {
            background: #fff;
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn--ghost:hover {
            background: #F3F4F6;
        }

        /* ===================== Hero / Carousel ===================== */
        .hero {
            position: relative;
            margin-top: var(--space-8);
        }

        .carousel {
            position: relative;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-elev);
            background: #000;
        }

        .carousel__track {
            position: relative;
            height: 380px;
        }

        .slide {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity .5s ease;
        }

        .slide.is-active {
            opacity: 1;
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .slide__overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(0, 0, 0, .2) 0%, rgba(0, 0, 0, .45) 100%);
        }

        .slide__content {
            position: absolute;
            left: 24px;
            right: 24px;
            bottom: 24px;
            color: #fff;
            z-index: 2;
        }

        .slide__title {
            font-size: clamp(24px, 3vw, 36px);
            font-weight: 800;
            margin: 0 0 6px 0;
        }

        .carousel__controls {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            z-index: 3;
            pointer-events: none;
        }

        .ctrl {
            width: 40px;
            height: 40px;
            border-radius: 999px;
            background: rgba(255, 255, 255, .9);
            border: 1px solid var(--color-border);
            display: grid;
            place-items: center;
            font-weight: 900;
            cursor: pointer;
            pointer-events: auto;
        }

        /* ===================== Global Search ===================== */
        .search-section {
            margin: var(--space-8) 0;
            display: flex;
            justify-content: flex-start;
        }

        .gsearch {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 10px 12px;
            box-shadow: var(--shadow-card);
            transition: box-shadow .18s, border-color .18s;
            width: 100%;
        }

        .gsearch:focus-within {
            border-color: var(--color-primary);
            box-shadow: 0 12px 28px rgba(0, 0, 0, .12);
        }

        .gsearch__icon {
            width: 18px;
            height: 18px;
            flex: none;
            color: var(--color-text-muted);
            display: grid;
            place-items: center;
        }

        .gsearch__icon svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .gsearch__input {
            flex: 1;
            border: none;
            outline: none;
            font: inherit;
            background: transparent;
            min-width: 0;
        }

        .gsearch__clear {
            display: none;
            border: 1px solid var(--color-border);
            background: #fff;
            border-radius: 999px;
            width: 24px;
            height: 24px;
            font-weight: 800;
            cursor: pointer;
            color: #6B7280;
        }

        .gsearch.has-value .gsearch__clear {
            display: inline-grid;
            place-items: center;
        }

        .gsearch__panel {
            position: absolute;
            left: 0;
            right: 0;
            top: calc(100% + 8px);
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: 0 16px 40px rgba(0, 0, 0, .12);
            overflow: hidden;
            display: none;
            z-index: 40;
            max-height: 60vh;
            overflow-y: auto;
        }

        .gsearch.is-open .gsearch__panel {
            display: block;
        }

        .gsearch__list {
            list-style: none;
            margin: 0;
            padding: 6px;
        }

        .gsearch__item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        .gsearch__item:hover, .gsearch__item.is-active {
            background: #F3F4F6;
        }

        .gsearch__name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .gsearch__badge {
            font-size: 12px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid var(--color-border);
            color: var(--color-text-muted);
        }

        .gsearch__arrow {
            color: var(--color-text-muted);
        }

        .gsearch__empty {
            padding: 14px;
            color: var(--color-text-muted);
        }

        .gsearch__footer {
            padding: 10px 12px;
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
        }

        .gsearch__footer a {
            font-weight: 600;
            color: var(--color-secondary);
        }

        .gsearch.is-loading .gsearch__list {
            padding: 8px;
        }

        .gsearch__skel {
            height: 16px;
            border-radius: 6px;
            overflow: hidden;
        }

        .gsearch__skel::before {
            content: "";
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #eee 0%, #f7f7f7 50%, #eee 100%);
            animation: gsearch-shimmer 1.1s infinite;
            background-size: 200% 100%;
        }

        @keyframes gsearch-shimmer {
            from {
                background-position: 200% 0;
            }
            to {
                background-position: -200% 0;
            }
        }

        /* ===================== Quick Actions (Reserve) ===================== */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr;
        }

        .qa-card {
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-card);
        }

        .qa-title {
            margin: 0 0 var(--space-5) 0;
            font-size: var(--h2-size);
            font-weight: var(--h2-w);
            color: var(--color-primary);
        }

        .reserve-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-5);
        }

        .field {
            display: grid;
            gap: 6px;
        }

        .label {
            font-weight: 600;
        }

        .input, .select {
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            font: inherit;
            background: #fff;
        }

        .hint {
            color: var(--color-text-muted);
            font-size: var(--small-size);
        }

        /* ===================== Sections & Grid ===================== */
        section.block {
            margin: var(--space-10) 0;
        }

        .block__head {
            display: flex;
            align-items: end;
            justify-content: space-between;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .block__title {
            font-size: var(--h2-size);
            font-weight: var(--h2-w);
            color: var(--color-primary);
            margin: 0;
        }

        .grid {
            display: grid;
            gap: var(--space-6);
        }

        .grid.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        /* ===================== Cards ===================== */
        .card {
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card__img {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }

        .card__body {
            padding: var(--space-5);
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }

        .card__title {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .card__desc {
            color: var(--color-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin: 0;
        }

        .card__meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .rating {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .stars {
            display: inline-flex;
            gap: 2px;
            color: #FACC15;
        }

        .stars svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .rating__label {
            font-weight: 700;
            font-size: 13px;
            color: #1f2937;
        }

        .sold {
            font-size: 13px;
            color: var(--color-text-muted);
        }

        .card__foot {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 4px;
        }

        .price {
            font-weight: 700;
        }

        /* ===================== Reviews / Marquee ===================== */
        .reviews-marquee {
            overflow: hidden;
            border-radius: var(--radius-xl);
        }

        .marquee-track {
            display: flex;
            gap: 24px;
            width: max-content;
            animation: reviews-marquee 40s linear infinite;
            padding: 4px;
        }

        .marquee-track:hover {
            animation-play-state: paused;
        }

        .marquee-group {
            display: flex;
            gap: 24px;
        }

        .review {
            width: 420px;
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            display: grid;
            gap: 6px;
            box-shadow: var(--shadow-card);
        }

        @keyframes reviews-marquee {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(-50%);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .marquee-track {
                animation: none;
            }
        }

        /* ===================== Modal ===================== */
        .modal {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: rgba(17, 24, 39, .5);
            z-index: 50;
        }

        .modal[hidden] {
            display: none;
        }

        .modal__panel {
            width: min(560px, 92vw);
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-elev);
            padding: 18px;
        }

        .modal__head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .modal__title {
            font-size: 18px;
            font-weight: 800;
            color: var(--color-primary);
            margin: 0;
        }

        .modal__body {
            margin-top: 8px;
            color: var(--color-text);
        }

        .modal__foot {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 16px;
        }

        /* ===================== Responsive ===================== */
        @media (max-width: 1200px) {
            .reserve-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .grid.cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .reserve-grid {
                grid-template-columns: 1fr;
            }

            .grid.cols-4 {
                grid-template-columns: 1fr;
            }

            .hero .carousel__track {
                height: 300px;
            }

            .review {
                width: 88vw;
            }
        }
    </style>

    <!-- Include shared styles/scripts from fragments if you have them -->
    <th:block th:replace="~{customer/fragments/header :: styles}"></th:block>
    <th:block th:replace="~{customer/fragments/footer :: styles}"></th:block>
</head>

<body>
<th:block th:replace="~{customer/fragments/header :: header}"></th:block>

<main>
    <div class="container">
        <!-- ===================== Hero ===================== -->
        <section aria-label="Hero" class="hero">
            <div aria-label="B·ªô s∆∞u t·∫≠p banner" aria-live="polite" aria-roledescription="carousel" class="carousel"
                 id="hero">
                <div class="carousel__track" id="hero-track">
                    <div role="group"
                         th:attr="aria-roledescription='slide', aria-label=${'Banner ' + (stat.index + 1)}"
                         th:class="${'slide' + (stat.index == 0 ? ' is-active' : '')}"
                         th:each="b, stat : ${banners}">
                        <img th:alt="${#strings.defaultString(b.title, 'Banner ·∫©m th·ª±c')}" th:src="${b.imageUrl}">
                        <div aria-hidden="true" class="slide__overlay"></div>
                        <div class="slide__content">
                            <h2 class="slide__title"
                                th:text="${#strings.defaultString(b.title, '·∫®m th·ª±c tinh t·∫ø m·ªói ng√†y')}">·∫®m th·ª±c tinh t·∫ø
                                m·ªói ng√†y</h2>
                            <div class="slide__cta">
                                <a class="btn btn--primary" th:href="@{/reservations/new}">ƒê·∫∑t ngay</a>
                                <a class="btn btn--secondary" th:href="@{/menu}">Xem th·ª±c ƒë∆°n</a>
                            </div>
                        </div>
                        <a class="sr-only" th:href="${b.linkUrl}" th:if="${b.linkUrl} != null">Xem chi ti·∫øt banner</a>
                    </div>
                </div>
                <div aria-hidden="false" class="carousel__controls">
                    <button aria-label="Slide tr∆∞·ªõc" class="ctrl" id="hero-prev">‚Äπ</button>
                    <button aria-label="Slide sau" class="ctrl" id="hero-next">‚Ä∫</button>
                </div>
            </div>
        </section>

        <!-- ===================== Global Search ===================== -->
        <section aria-labelledby="gsearch-title" class="search-section">
            <h2 class="sr-only" id="gsearch-title">T√¨m m√≥n ho·∫∑c combo</h2>
            <div class="gsearch" data-api="/api/public/search/suggest" id="gsearch">
          <span aria-hidden="true" class="gsearch__icon">
            <svg aria-hidden="true" focusable="false" viewBox="0 0 24 24"><path
                    d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          </span>
                <input aria-autocomplete="list" aria-controls="gsearch-listbox" aria-expanded="false" autocomplete="off"
                       class="gsearch__input" id="gsearch-input" placeholder="T√¨m m√≥n, combo..." role="combobox"
                       type="search"/>
                <button aria-label="Xo√°" class="gsearch__clear" id="gsearch-clear" type="button">√ó</button>
                <div class="gsearch__panel" id="gsearch-panel">
                    <ul class="gsearch__list" id="gsearch-listbox" role="listbox"></ul>
                    <div class="gsearch__empty" hidden id="gsearch-empty">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.</div>
                    <div class="gsearch__footer"><a href="/menu">Xem to√†n b·ªô th·ª±c ƒë∆°n ‚Üí</a></div>
                </div>
            </div>
        </section>

        <!-- ===================== Quick Actions (Reserve Table) ===================== -->
        <section aria-labelledby="qa-title" class="quick-actions">
            <div class="qa-card">
                <h2 class="qa-title" id="qa-title">ƒê·∫∑t b√†n nhanh</h2>
                <form class="reserve-grid" id="reserve-form" novalidate>
                    <div class="field">
                        <label class="label" for="res-date">Ng√†y ƒë·∫øn</label>
                        <input class="input" id="res-date" required type="date"/>
                    </div>
                    <div class="field">
                        <label class="label" for="res-time">Gi·ªù ƒë·∫øn</label>
                        <input class="input" id="res-time" required step="900" type="time"/>
                    </div>
                    <div class="field">
                        <label class="label" for="res-dep">Gi·ªù ƒëi</label>
                        <input class="input" id="res-dep" required step="900" type="time"/>
                    </div>
                    <div class="field">
                        <label class="label" for="res-size">S·ªë kh√°ch</label>
                        <select aria-label="S·ªë kh√°ch" class="select" id="res-size">
                            <option th:each="i : ${#numbers.sequence(1,10)}" th:text="${i}" th:value="${i}"></option>
                        </select>
                    </div>
                </form>
                <div style="margin-top: var(--space-5); display:flex; gap:12px; flex-wrap:wrap;">
                    <button class="btn btn--primary" id="checkAvail" type="button">Ki·ªÉm tra b√†n tr·ªëng</button>
                    <a class="btn btn--secondary" th:href="@{/reservations/new}">M·ªü trang ƒë·∫∑t b√†n</a>
                </div>
            </div>
        </section>

        <!-- ===================== Featured Menu ===================== -->
        <section aria-labelledby="feat-title" class="block">
            <div class="block__head">
                <h2 class="block__title" id="feat-title">M√≥n n·ªïi b·∫≠t</h2>
            </div>
            <div class="grid cols-4" id="featured-grid">
                <article class="card" th:each="it : ${items}">
                    <img class="card__img" th:alt="${it.name}" th:src="${it.imageUrl}"/>
                    <div class="card__body">
                        <h3 class="card__title" th:text="${it.name}">T√™n m√≥n</h3>
                        <p class="card__desc" th:text="${it.description}">M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ m√≥n ƒÉn</p>
                        <div class="card__meta">
                            <div aria-label="5 tr√™n 5 sao" class="rating" role="img">
                                <div aria-hidden="true" class="stars">
                                    <svg viewBox="0 0 20 20">
                                        <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                    </svg>
                                    <svg viewBox="0 0 20 20">
                                        <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                    </svg>
                                    <svg viewBox="0 0 20 20">
                                        <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                    </svg>
                                    <svg viewBox="0 0 20 20">
                                        <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                    </svg>
                                    <svg viewBox="0 0 20 20">
                                        <path d="M10 1.5l2.58 5.23 5.77.84-4.18 4.07.99 5.76L10 14.9l-5.16 2.5.99-5.76L1.65 7.57l5.77-.84L10 1.5z"/>
                                    </svg>
                                </div>
                                <span class="rating__label">5.0</span>
                            </div>
                            <span class="sold" th:text="${(it.soldCount != null ? it.soldCount : 0)} + ' ƒë√£ b√°n'">0 ƒë√£ b√°n</span>
                        </div>
                        <div class="card__foot">
                            <span class="price price-vnd" th:attr="data-price=${it.price}">0 VND</span>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <!-- ===================== Reviews ===================== -->
        <section aria-labelledby="reviews-title" class="block">
            <h2 class="block__title" id="reviews-title">Kh√°ch h√†ng n√≥i g√¨?</h2>
            <div aria-live="polite" class="reviews-marquee">
                <div class="marquee-track">
                    <!-- Group 1 -->
                    <div class="marquee-group">
                        <article class="review" th:each="fb : ${feedbacks}">
                            <div class="stars"
                                 th:with="rate=${fb.rating == null ? 0 : (fb.rating < 0 ? 0 : (fb.rating > 5 ? 5 : fb.rating))}">
                                <span th:each="i : ${#numbers.sequence(1, rate)}">‚òÖ</span><span th:each="i : ${#numbers.sequence(1, 5 - rate)}"
                                                                                                th:if="${rate < 5}">‚òÜ</span>
                            </div>
                            <p style="margin:4px 0 0 0;" th:text="${fb.comments}">N·ªôi dung feedback</p>
                            <small th:text="${#dates.format(fb.createdDate, 'd/M/yyyy')}">15/9/2025</small>
                        </article>
                    </div>
                    <!-- Group 2 (clone) -->
                    <div class="marquee-group">
                        <article class="review" th:each="fb : ${feedbacks}">
                            <div aria-hidden="true" class="stars"
                                 th:with="rate=${fb.rating == null ? 0 : (fb.rating > 5 ? 5 : (fb.rating < 0 ? 0 : fb.rating))}">
                                <span th:each="i : ${#numbers.sequence(1, rate)}">‚òÖ</span>
                                <span th:each="i : ${#numbers.sequence(1, 5 - rate)}">‚òÜ</span>
                            </div>
                            <p style="margin:4px 0 0 0;" th:text="${fb.comments}">N·ªôi dung feedback</p>
                            <small th:text="${#dates.format(fb.createdDate, 'd/M/yyyy')}">15/9/2025</small>
                        </article>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<!-- ===================== Modal ===================== -->
<div aria-hidden="true" aria-labelledby="avail-title" aria-modal="true" class="modal" hidden id="avail-modal"
     role="dialog">
    <div class="modal__panel">
        <div class="modal__head">
            <h3 class="modal__title" id="avail-title">K·∫øt qu·∫£ ki·ªÉm tra</h3>
            <button aria-label="ƒê√≥ng" class="btn btn--ghost" id="modalClose">‚úï</button>
        </div>
        <div class="modal__body" id="avail-body"></div>
        <div class="modal__foot" id="avail-actions"></div>
    </div>
</div>

<!-- Footer fragments -->
<th:block th:replace="~{customer/fragments/footer :: footer}"></th:block>
<th:block th:replace="~{customer/fragments/footer :: scripts}"></th:block>
<th:block th:replace="~{customer/fragments/header :: scripts}"></th:block>

<!-- ===================== JS (Clean, Modular) ===================== -->
<script>
    (function () {
        "use strict";

        // ---------- Helpers ----------
        const $ = (sel, ctx = document) => ctx.querySelector(sel);
        const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));

        const CSRF = {
            token: document.querySelector('meta[name="_csrf"]')?.getAttribute('content') || null,
            header: document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content') || 'X-CSRF-TOKEN'
        };

        function withCsrf(init = {}) {
            const headers = new Headers(init.headers || {});
            if (CSRF.token) headers.set(CSRF.header, CSRF.token);
            return {...init, headers};
        }

        // ---------- Carousel ----------
        function Carousel(rootId, {interval = 5000} = {}) {
            const root = document.getElementById(rootId);
            if (!root) return;
            const slides = $$('.slide', root);
            const prevBtn = $('#hero-prev');
            const nextBtn = $('#hero-next');
            let i = 0, timer = null;

            function show(n) {
                i = (n + slides.length) % slides.length;
                slides.forEach((s, k) => s.classList.toggle('is-active', k === i));
            }

            function play() {
                stop();
                timer = setInterval(() => show(i + 1), interval);
            }

            function stop() {
                if (timer) {
                    clearInterval(timer);
                    timer = null;
                }
            }

            prevBtn?.addEventListener('click', () => {
                show(i - 1);
            });
            nextBtn?.addEventListener('click', () => {
                show(i + 1);
            });
            root.addEventListener('mouseenter', stop);
            root.addEventListener('mouseleave', play);

            play();
        }

        // ---------- Global Search ----------
        function GlobalSearch() {
            const root = document.getElementById('gsearch');
            if (!root) return;

            const API = root.dataset.api || '/api/public/search/suggest';
            const input = $('#gsearch-input');
            const panel = $('#gsearch-panel');
            const list = $('#gsearch-listbox');
            const empty = $('#gsearch-empty');
            const clearBtn = $('#gsearch-clear');

            let timer = null, active = -1, items = [], ac = null;

            const open = () => {
                root.classList.add('is-open');
                input.setAttribute('aria-expanded', 'true');
            };
            const close = () => {
                root.classList.remove('is-open');
                input.setAttribute('aria-expanded', 'false');
                active = -1;
                input.removeAttribute('aria-activedescendant');
            };
            const setValueState = () => root.classList.toggle('has-value', !!input.value.trim());

            function skeleton(n = 5) {
                list.innerHTML = Array.from({length: n}, () => `<li class="gsearch__item"><span class="gsearch__badge gsearch__skel" style="width:48px"></span><span class="gsearch__skel" style="width:60%"></span></li>`).join('');
            }

            function highlight(text, kw) {
                const t = text ?? '';
                const q = kw ?? '';
                const i = t.toLowerCase().indexOf(q.toLowerCase());
                const esc = s => s.replace(/[&<>"']/g, c => ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    '\'': '&#39;'
                }[c]));
                if (i < 0) return esc(t);
                return esc(t.slice(0, i)) + '<strong>' + esc(t.slice(i, i + q.length)) + '</strong>' + esc(t.slice(i + q.length));
            }

            function setActive(idx) {
                const els = $$('.gsearch__item', list);
                els.forEach((el, k) => el.classList.toggle('is-active', k === idx));
                active = idx;
                if (idx >= 0 && els[idx]) input.setAttribute('aria-activedescendant', els[idx].id);
            }

            function go(idx) {
                if (idx < 0 || !items[idx]) return;
                const href = items[idx].url;
                if (href) window.location.href = href;
            }

            function render(q, data) {
                items = Array.isArray(data) ? data : [];
                if (!items.length) {
                    list.innerHTML = '';
                    empty.hidden = false;
                    open();
                    return;
                }
                empty.hidden = true;
                list.innerHTML = items.map((it, idx) => {
                    const type = it.type === 'ITEM' ? 'M√≥n' : (it.type === 'COMBO' ? 'Combo' : 'Kh√°c');
                    const id = `gopt-${idx}`;
                    return `<li role="option" id="${id}" class="gsearch__item" data-idx="${idx}" data-href="${it.url}">\
            <span class="gsearch__badge">${type}</span>\
            <span class="gsearch__name">${highlight(it.name || '', q)}</span>\
            <span class="gsearch__arrow" aria-hidden="true">‚Üµ</span>\
          </li>`;
                }).join('');
                open();
                $$('.gsearch__item', list).forEach(el => {
                    el.addEventListener('mouseenter', () => setActive(parseInt(el.dataset.idx, 10)));
                    el.addEventListener('mousedown', e => e.preventDefault()); // keep focus
                    el.addEventListener('click', () => go(parseInt(el.dataset.idx, 10)));
                });
            }

            function fetchSuggest(q) {
                if (ac) ac.abort();
                ac = new AbortController();
                root.classList.add('is-loading');
                skeleton();
                open();
                fetch(`${API}?q=${encodeURIComponent(q)}&limit=8`, withCsrf({method: 'GET', signal: ac.signal}))
                    .then(res => res.ok ? res.json() : [])
                    .then(data => render(q, data))
                    .catch(() => {
                        list.innerHTML = '';
                        empty.hidden = false;
                        open();
                    })
                    .finally(() => root.classList.remove('is-loading'));
            }

            function handleInput() {
                setValueState();
                const q = input.value.trim();
                if (!q) {
                    close();
                    list.innerHTML = '';
                    empty.hidden = true;
                    return;
                }
                clearTimeout(timer);
                timer = setTimeout(() => fetchSuggest(q), 200);
            }

            input.addEventListener('input', handleInput);
            input.addEventListener('focus', handleInput);
            input.addEventListener('keydown', (e) => {
                if (!root.classList.contains('is-open')) return;
                const n = list.children.length || 0;
                if (!n) return;
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setActive((active + 1 + n) % n);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    setActive((active - 1 + n) % n);
                } else if (e.key === 'Enter') {
                    if (active >= 0) go(active);
                } else if (e.key === 'Escape') {
                    close();
                }
            });
            clearBtn.addEventListener('click', () => {
                input.value = '';
                setValueState();
                close();
                input.focus();
            });
            input.addEventListener('blur', () => setTimeout(() => {
                if (!root.contains(document.activeElement)) close();
            }, 120));
            panel.addEventListener('blur', () => setTimeout(() => {
                if (!root.contains(document.activeElement)) close();
            }, 120), true);
            document.addEventListener('click', (e) => {
                if (!root.contains(e.target)) close();
            });
        }

        // ---------- Price (VND) ----------
        function PriceVND() {
            const els = $$('.price-vnd');
            els.forEach(el => {
                const p = Number(el.getAttribute('data-price') || 0);
                el.textContent = new Intl.NumberFormat('vi-VN').format(Math.round(p)) + ' VND';
            });
        }

        // ---------- Modal ----------
        const Modal = (function () {
            const modal = $('#avail-modal');
            const title = $('#avail-title');
            const body = $('#avail-body');
            const foot = $('#avail-actions');
            const closeBtn = $('#modalClose');

            function open({titleText, html, actions = []}) {
                title.textContent = titleText || 'Th√¥ng b√°o';
                body.innerHTML = html || '';
                foot.innerHTML = '';
                actions.forEach(a => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = `btn ${a.variant || 'btn--ghost'}`;
                    btn.textContent = a.label;
                    btn.addEventListener('click', a.onClick);
                    foot.appendChild(btn);
                });
                modal.hidden = false;
                modal.setAttribute('aria-hidden', 'false');
                const escHandler = e => {
                    if (e.key === 'Escape') close();
                };
                const overlayHandler = e => {
                    if (e.target === modal) close();
                };

                function close() {
                    modal.hidden = true;
                    modal.setAttribute('aria-hidden', 'true');
                    document.removeEventListener('keydown', escHandler);
                    modal.removeEventListener('click', overlayHandler);
                    closeBtn.replaceWith(closeBtn.cloneNode(true));
                }

                document.addEventListener('keydown', escHandler);
                modal.addEventListener('click', overlayHandler);
                $('#modalClose').addEventListener('click', () => close());
            }

            return {open};
        })();

        // ---------- Reserve Availability ----------
        function Reserve() {
            const btn = $('#checkAvail');
            const dateEl = $('#res-date');
            const timeEl = $('#res-time');
            const depEl = $('#res-dep');
            const sizeEl = $('#res-size');

            // Prefill values (today, next quarter-hour, +90m)
            (function prefill() {
                const d = new Date();
                const pad = n => String(n).padStart(2, '0');
                dateEl.value = d.toISOString().slice(0, 10);
                const r = Math.ceil(d.getMinutes() / 15) * 15;
                let hh = d.getHours();
                let mm = r === 60 ? 0 : r;
                if (r === 60) hh = (hh + 1) % 24;
                timeEl.value = `${pad(hh)}:${pad(mm)}`;
                const dep = new Date(d.getTime() + 90 * 60000);
                const rh = dep.getHours();
                const rm = Math.ceil(dep.getMinutes() / 15) * 15 % 60;
                depEl.value = `${pad(rh)}:${pad(rm)}`;
            })();

            async function checkAvailability() {
                const date = dateEl.value;
                const time = timeEl.value;
                const departureTime = depEl.value;
                const numberOfGuests = parseInt(sizeEl.value, 10);
                if (!date || !time || !departureTime || !numberOfGuests || numberOfGuests <= 0) {
                    Modal.open({
                        titleText: 'Thi·∫øu th√¥ng tin',
                        html: '<p>Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y, gi·ªù ƒë·∫øn, gi·ªù ƒëi v√† s·ªë kh√°ch.</p>',
                        actions: [{
                            label: 'ƒê√≥ng', variant: 'btn--ghost', onClick: () => {
                                $('#avail-modal').hidden = true;
                            }
                        }]
                    });
                    return;
                }
                if (departureTime <= time) {
                    Modal.open({
                        titleText: 'Gi·ªù ƒëi kh√¥ng h·ª£p l·ªá',
                        html: '<p>Gi·ªù ƒëi ph·∫£i sau gi·ªù ƒë·∫øn. Vui l√≤ng ch·ªânh l·∫°i.</p>',
                        actions: [{
                            label: 'ƒê√≥ng', variant: 'btn--ghost', onClick: () => {
                                $('#avail-modal').hidden = true;
                            }
                        }]
                    });
                    return;
                }
                const q = new URLSearchParams({date, time, departureTime, numberOfGuests: String(numberOfGuests)});
                const apiUrl = `/api/available-tables?${q.toString()}`;
                btn.disabled = true;
                const old = btn.textContent;
                btn.textContent = 'ƒêang ki·ªÉm tra...';
                try {
                    const res = await fetch(apiUrl, withCsrf({method: 'GET'}));
                    if (!res.ok) throw new Error('API error');
                    const data = await res.json();
                    if (Array.isArray(data) && data.length > 0) {
                        const reserveUrl = `${window.location.origin}/reservations/new?date=${encodeURIComponent(date)}&time=${encodeURIComponent(time)}&departureTime=${encodeURIComponent(departureTime)}&numberOfGuests=${encodeURIComponent(numberOfGuests)}`;
                        const sample = data.slice(0, 3).map(t => `<li>B√†n ${t.tableName} ‚Ä¢ ${t.capacity} kh√°ch ‚Ä¢ ${t.areaName || 'Khu v·ª±c'}</li>`).join('');
                        Modal.open({
                            titleText: 'C√≥ b√†n tr·ªëng üéâ',
                            html: `<p>Ch√∫ng t√¥i t√¨m th·∫•y <strong>${data.length}</strong> b√†n ph√π h·ª£p cho khung gi·ªù b·∫°n ch·ªçn.</p>${sample ? `<ul>${sample}</ul>` : ''}`,
                            actions: [{
                                label: 'H·ªßy', variant: 'btn--ghost', onClick: () => {
                                    $('#avail-modal').hidden = true;
                                }
                            }, {
                                label: 'ƒê·∫∑t b√†n ngay', variant: 'btn--primary', onClick: () => {
                                    window.location.href = reserveUrl;
                                }
                            }]
                        });
                    } else {
                        Modal.open({
                            titleText: 'H·∫øt b√†n',
                            html: '<p>Hi·ªán t·∫°i kh√¥ng c√≤n b√†n tr·ªëng cho th·ªùi gian n√†y. Vui l√≤ng ch·ªçn th·ªùi gian kh√°c.</p>',
                            actions: [{
                                label: 'ƒê√£ hi·ªÉu', variant: 'btn--primary', onClick: () => {
                                    $('#avail-modal').hidden = true;
                                }
                            }]
                        });
                    }
                } catch (e) {
                    Modal.open({
                        titleText: 'L·ªói',
                        html: '<p>Kh√¥ng th·ªÉ ki·ªÉm tra kh·∫£ d·ª•ng. Vui l√≤ng th·ª≠ l·∫°i sau.</p>',
                        actions: [{
                            label: 'ƒê√≥ng', variant: 'btn--ghost', onClick: () => {
                                $('#avail-modal').hidden = true;
                            }
                        }]
                    });
                } finally {
                    btn.disabled = false;
                    btn.textContent = old;
                }
            }

            btn.addEventListener('click', checkAvailability);
        }

        // ---------- Boot ----------
        function boot() {
            Carousel('hero', {interval: 5000});
            GlobalSearch();
            Reserve();
            PriceVND();
        }

        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', boot); else boot();
    })();
</script>

<!-- AI Chatbot Widget -->
<th:block th:replace="~{customer/fragments/ai-chatbot-widget :: chatbot-widget}"></th:block>

<!-- AI Chatbot Scripts -->
<th:block th:replace="~{customer/fragments/ai-chatbot-widget :: chatbot-scripts}"></th:block>

</body>
</html>
